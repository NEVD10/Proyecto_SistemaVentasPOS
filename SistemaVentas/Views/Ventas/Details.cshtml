@using System.Linq
@model SistemaVentas.Models.Venta
@{
    ViewData["Title"] = "Detalles de Venta";
}

<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-md-8">
            <h2 class="text-primary">
                <i class="bi bi-eye me-2"></i>Detalles de Venta #@Model.IdVenta.ToString("D6")
            </h2>
            <p class="text-muted">Información completa de la transacción seleccionada</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="@Url.Action("Index", "Ventas")" class="btn btn-outline-secondary">
                <i class="bi bi-arrow-left me-2"></i>Volver al Historial
            </a>
        </div>
    </div>

    <!-- Información General -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="bi bi-info-circle me-2"></i>Información General
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">ID Venta:</dt>
                        <dd class="col-sm-8">#@Model.IdVenta.ToString("D6")</dd>
                        <dt class="col-sm-4">Fecha:</dt>
                        <dd class="col-sm-8">@Model.FechaVenta.ToString("dd/MM/yyyy HH:mm:ss")</dd>
                        <dt class="col-sm-4">Tipo Comprobante:</dt>
                        <dd class="col-sm-8">@Model.TipoComprobante</dd>
                        <dt class="col-sm-4">Método de Pago:</dt>
                        <dd class="col-sm-8">@Model.MetodoPago</dd>
                    </dl>
                </div>
                <div class="col-md-6">
                    <dl class="row">
                        <dt class="col-sm-4">Cliente:</dt>
                        <dd class="col-sm-8">
                            @if (Model.Cliente != null)
                            {
                                <span>@Model.Cliente.Nombres @Model.Cliente.Apellidos (@Model.Cliente.TipoDocumento: @Model.Cliente.NumeroDocumento)</span>
                            }
                            else
                            {
                                <span class="text-muted">Cliente General</span>
                            }
                        </dd>
                        <dt class="col-sm-4">Usuario:</dt>
                        <dd class="col-sm-8">
                            @if (Model.Usuario != null)
                            {
                                <span>@Model.Usuario.NombreUsuario</span>
                            }
                            else
                            {
                                <span class="text-muted">Sistema</span>
                            }
                        </dd>
                    </dl>
                </div>
            </div>
        </div>
    </div>

    <!-- Detalles de Productos -->
    <div class="card mb-4">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="bi bi-cart me-2"></i>Productos Vendidos
            </h5>
        </div>
        <div class="card-body">
            @if (Model.DetalleVentas != null && ((List<SistemaVentas.Models.DetalleVenta>)Model.DetalleVentas).Count > 0)
            {
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th>Producto</th>
                                <th>Cantidad</th>
                                <th>Precio Unitario</th>
                                <th>Subtotal</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var detalle in Model.DetalleVentas)
                            {
                                var producto = ViewData["Productos"] as List<SistemaVentas.Models.Producto>;
                                var productoNombre = producto?.FirstOrDefault(p => p.IdProducto == detalle.IdProducto)?.Nombre ?? "No encontrado";
                                <tr>
                                    <td>@productoNombre</td>
                                    <td>@detalle.Cantidad</td>
                                    <td>S/ @detalle.PrecioUnitario.ToString("N2")</td>
                                    <td><strong>S/ @detalle.SubtotalLinea.ToString("N2")</strong></td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            }
            else
            {
                <div class="text-center py-5">
                    <i class="bi bi-inbox text-muted" style="font-size: 4rem;"></i>
                    <h4 class="text-muted mt-3">No hay productos</h4>
                </div>
            }
        </div>
    </div>

    <!-- Totales -->
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="bi bi-calculator me-2"></i>Resumen de Totales
            </h5>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-4">
                    <div class="d-flex justify-content-between">
                        <span>Subtotal:</span>
                        <strong>S/ @Model.Subtotal.ToString("N2")</strong>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="d-flex justify-content-between">
                        <span>IGV (18%):</span>
                        <strong>S/ @Model.MontoIGV.ToString("N2")</strong>
                    </div>
                </div>
                <div class="col-md-4">
                    <div class="d-flex justify-content-between">
                        <span class="h5">Total:</span>
                        <strong class="h4 text-success">S/ @Model.MontoTotal.ToString("N2")</strong>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
}